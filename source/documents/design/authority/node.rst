.. _node-manage:

===========
节点管理
===========

为了保证区块链的安全性， Venachain 通过节点管理合约对节点进行管理，包括节点是否能够接入网络，节点是否能够参与共识以及节点信息的维护等功能。根据之前用户角色的设定，只有 chainCreator 、 chainAdmin 和 nodeAdmin 这三类用户才可以设置系统合约中的节点数据，当需要添加节点、更新节点状态、删除节点时都需要这三类账户来调用节点管理合约。需要注意的是 nodeAdmin 仅可以管理自己加入的节点， chainCreator 和 chainAdmin 可以管理所有节点。

节点类型
===============

观察者节点
^^^^^^^^^^^^^^^

观察者节点负责同步区块但并不参与投票出块。

系统中，将会一直存在几个稳定的观察者节点。
用于其他节点连接，从而进行稳定的同步区块。
新节点启动时，使用 bootnodes 参数指定 **稳点的观察者节点** 进行连接，连接成功之后，则可正常同步区块。

共识节点
^^^^^^^^^^^

共识节点参与投票出块，以及同步区块。

在 Venachain 刚启动之际，系统合约还并未部署，此时网络中的共识节点将会由 ``genesis.json`` 中 firstValidatorNode 中指定的第一个节点来承担。
由此节点进行共识出块。直到 Venachain 部署完系统合约，并且成功的在节点管理合约中指定了新的共识节点之后，由合约中指定的多个共识节点进行相互投票和出块。

节点状态
=============

节点状态可以使用节点管理系统合约的相应的 API 进行设置和更改。

删除状态
^^^^^^^^^

删除状态下的节点无法连接其他节点，也无法被其他节点进行连接。
删除状态下的节点将会永久的停留在删除状态，不允许恢复。

正常状态
^^^^^^^^^^

正常状态下的节点，可以主动连接其他节点，也可以被其他正常状态下的节点进行连接。

节点启动
===========

节点启动时，除了指定 Venachain 常规参数外，还需要指定 ``--bootnodes`` ， bootnodes 指定范围建议是稳定的观察者节点。


节点连接
=============

节点 A 启动后，会主动连接 ``--bootnodes`` 指定的节点 B ，而在节点B中，会检查节点 A 是否在存在于节点管理合约中，并且节点状态为正常状态。只有检查通过，此时节点 B 才会接受节点 A 的连接请求。
当节点成功连接之后，就可以进行同步区块等操作。

节点更新
===========

节点管理合约提供相应的节点更新操作。可以按需更改合约中已添加的节点的状态，类型等节点信息。